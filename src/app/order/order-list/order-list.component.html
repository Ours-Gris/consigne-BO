<div class="container">
    <div class="row">
        <div class="col-md-12 pt-2">
            <h3 i18n="@@UserList.title">Liste des commandes</h3>

            <!--            <div>-->
            <!--                <label for="searchInput">-->
            <!--                    <input matInput-->
            <!--                           id="searchInput"-->
            <!--                           i18n-placeholder="@@UserList.findOrder.placeholder"-->
            <!--                           placeholder="Rechercher une livraison"-->
            <!--                           #input>-->
            <!--                </label>-->
            <!--            </div>-->

            <table mat-table
                   class="lessons-table mat-elevation-z8"
                   multiTemplateDataRows
                   *ngIf="orders"
                   [dataSource]="orders"
                   matSort
                   matSortActive="createdAt"
                   matSortDirection="desc">

                <!-- order_status Column -->
                <ng-container matColumnDef="order_status">
                    <th mat-header-cell
                        mat-sort-header=""
                        *matHeaderCellDef
                        i18n="@@UserAttributes.order_status"> Statut de la commande
                    </th>
                    <td mat-cell
                        *matCellDef="let order">
                        <mat-chip-list>
                            <mat-chip selected
                                      [color]="order.order_status === OrderStatus.COMPLETE || order.order_status === OrderStatus.CANCELLED ? 'primary' : 'accent'">
                                {{order.order_status | orderStatus}}
                            </mat-chip>
                        </mat-chip-list>
                    </td>
                </ng-container>

                <!-- Company Column -->
                <ng-container matColumnDef="company">
                    <th mat-header-cell
                        mat-sort-header=""
                        *matHeaderCellDef
                        i18n="@@UserAttributes.company"> Société
                    </th>
                    <td mat-cell
                        *matCellDef="let order"> {{order.user && order.user.company ? order.user.company : '-'}} </td>
                </ng-container>

                <!-- Username Column -->
                <ng-container matColumnDef="username">
                    <th mat-header-cell
                        mat-sort-header=""
                        *matHeaderCellDef
                        i18n="@@UserAttributes.username"> Nom
                    </th>
                    <td mat-cell
                        *matCellDef="let order"> {{order.user && order.user.username ? order.user.username : '-'}} </td>
                </ng-container>

                <!-- Tel Column -->
                <ng-container matColumnDef="tel">
                    <th mat-header-cell
                        mat-sort-header=""
                        *matHeaderCellDef
                        i18n="@@UserAttributes.tel"> Téléphone
                    </th>
                    <td mat-cell
                        *matCellDef="let order"> {{order.user && order.user.tel ? order.user.tel : '-'}} </td>
                </ng-container>

                <!-- delivery_schedules Column -->
                <ng-container matColumnDef="delivery_schedules">
                    <th mat-header-cell
                        mat-sort-header=""
                        *matHeaderCellDef
                        i18n="@@UserAttributes.delivery_schedules"> Horaires livraison
                    </th>
                    <td mat-cell
                        *matCellDef="let order"> {{order.user && order.user.delivery_schedules ? order.user.delivery_schedules : '-'}} </td>
                </ng-container>

                <!-- delivery_data Column -->
                <ng-container matColumnDef="delivery_data">
                    <th mat-header-cell
                        mat-sort-header=""
                        *matHeaderCellDef
                        i18n="@@UserAttributes.delivery_data"> Informations livraison
                    </th>
                    <td mat-cell
                        *matCellDef="let order"> {{order.user && order.user.delivery_data ? order.user.delivery_data : '-'}} </td>
                </ng-container>

                <!-- City Column -->
                <ng-container matColumnDef="city">
                    <th mat-header-cell
                        mat-sort-header=""
                        *matHeaderCellDef
                        i18n="@@UserAttributes.city"> Ville
                    </th>
                    <td mat-cell
                        *matCellDef="let order">{{order.user && order.user.delivery_address ? order.user.delivery_address.city : '-'}}
                    </td>
                </ng-container>

                <!-- Date Column -->
                <ng-container matColumnDef="createdAt">
                    <th mat-header-cell
                        mat-sort-header=""
                        *matHeaderCellDef
                        i18n="@@OrderAttributes.createdAt"> Date de création
                    </th>
                    <td mat-cell
                        *matCellDef="let order">{{order.createdAt | date}}
                    </td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                    <th mat-header-cell
                        *matHeaderCellDef
                        i18n="@@order.actions"> Actions
                    </th>
                    <td mat-cell
                        *matCellDef="let order">
                        <button mat-mini-fab
                                *ngIf="order.order_status === OrderStatus.PENDING_VALIDATION"
                                (click)="validOrder(order.id)"
                                matTooltip="Valider la commande"
                                class="m-lg-2"
                                color="accent">
                            <mat-icon>done</mat-icon>
                        </button>
                        <button mat-mini-fab
                                *ngIf="order.order_status === OrderStatus.PENDING_DELIVERY"
                                (click)="validDelivery(order.id)"
                                matTooltip="Valider la livraison"
                                class="m-lg-2"
                                color="accent">
                            <mat-icon>local_shipping</mat-icon>
                        </button>
                        <button mat-mini-fab
                                *ngIf="order.order_status === OrderStatus.PENDING_PAYMENT"
                                (click)="validPayment(order.id)"
                                matTooltip="Valider le payment"
                                class="m-lg-2"
                                color="accent">
                            <mat-icon>credit_score</mat-icon>
                        </button>
                        <button mat-mini-fab
                                *ngIf="order.order_status !== OrderStatus.COMPLETE && order.order_status !== OrderStatus.CANCELLED"
                                (click)="cancelledOrder(order.id)"
                                matTooltip="Valider le payment"
                                class="m-lg-2"
                                color="accent">
                            <mat-icon>cancel</mat-icon>
                        </button>
                    </td>
                </ng-container>

                <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                <ng-container matColumnDef="expandedDetail">
                    <td mat-cell
                        *matCellDef="let order"
                        [attr.colspan]="displayedColumns.length">
                        <div class="example-element-detail"
                             [@detailExpand]="order == expandedOrder ? 'expanded' : 'collapsed'"
                             *ngFor="let item of order.items">
                            <img *ngIf="item.material.img_name"
                                 src="{{this.authUrl + '/materials/file/' + item.material.img_name}}"
                                 alt="Image material"
                                 class="example-element-diagram">
                            <div class="example-element-description">
                                {{item.material.name}} x {{item.quantity}}
                            </div>
                            <div class="example-element-description">
                                {{item.material.description}}
                            </div>
                        </div>
                    </td>
                </ng-container>

                <tr mat-header-row
                    *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row
                    *matRowDef="let order; columns: displayedColumns"
                    class="example-element-row"
                    [class.example-expanded-row]="expandedOrder === order"
                    (click)="expandedOrder = expandedOrder === order ? null : order"></tr>
                <tr mat-row
                    *matRowDef="let row; columns: ['expandedDetail']"
                    class="example-detail-row"></tr>
            </table>

            <mat-paginator [pageIndex]="0"
                           [length]="totalOrders"
                           [pageSize]="10"
                           [pageSizeOptions]="[10, 20, 50]"
                           [showFirstLastButtons]="true"></mat-paginator>

            <div class="spinner-container"
                 *ngIf="orders && orders.loading$ | async">
                <mat-progress-bar mode="indeterminate"></mat-progress-bar>
            </div>
        </div>
    </div>
</div>
